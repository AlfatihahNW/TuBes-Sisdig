library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;

entity debouncer is
    Generic (
        CLK_FREQ    : integer := 50_000_000;
        STABLE_TIME : integer := 10
    );
    Port (
        clk     : in  STD_LOGIC;
        rst_n   : in  STD_LOGIC;
        btn_in  : in  STD_LOGIC;
        btn_out : out STD_LOGIC
    );
end debouncer;

architecture Behavioral of debouncer is
    constant COUNTER_MAX : integer := (CLK_FREQ / 1000) * STABLE_TIME;
    signal counter : integer range 0 to COUNTER_MAX := 0;
    signal btn_sync_0, btn_sync_1 : std_logic := '0';
    signal btn_stable : std_logic := '0';
begin

    process(clk, rst_n)
    begin
        if rst_n = '0' then
            counter <= 0;
            btn_out <= '0';
            btn_sync_0 <= '0';
            btn_sync_1 <= '0';
            btn_stable <= '0';
        elsif rising_edge(clk) then
            -- 1. Input Synchronizer
            btn_sync_0 <= btn_in;
            btn_sync_1 <= btn_sync_0;

            -- 2. Debouncing
            if (btn_stable /= btn_sync_1) then
                if counter < COUNTER_MAX then
                    counter <= counter + 1;
                else
                    btn_stable <= btn_sync_1;
                    counter <= 0;
                end if;
            else
                counter <= 0;
            end if;
            
            -- 3. Output Assignment
            btn_out <= btn_stable;
        end if;
    end process;

end Behavioral;











